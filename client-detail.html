<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Cliente ‚Äî InDubai Portal</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/css/style.css">
  <script src="/js/config.js"></script>
  <style>
    .client-header { background: var(--primary); color: white; padding: 24px 32px; border-radius: 12px; margin-bottom: 20px; display: flex; align-items: center; gap: 20px; }
    .client-avatar { width: 56px; height: 56px; border-radius: 14px; background: rgba(255,255,255,.2); display: flex; align-items: center; justify-content: center; font-size: 22px; font-weight: 900; flex-shrink: 0; }
    .client-name { font-size: 20px; font-weight: 800; margin-bottom: 4px; }
    .client-meta { font-size: 13px; opacity: .8; display: flex; gap: 16px; flex-wrap: wrap; }
    .tab-bar { display: flex; gap: 4px; margin-bottom: 20px; background: var(--surface2); padding: 4px; border-radius: 10px; }
    .tab { padding: 8px 16px; border-radius: 8px; border: none; background: transparent; cursor: pointer; font-size: 13px; font-weight: 600; color: var(--text-muted); transition: all .15s; }
    .tab.active { background: white; color: var(--primary); box-shadow: 0 1px 4px rgba(0,0,0,.1); }
    .tab-panel { display: none; }
    .tab-panel.active { display: block; }
    .info-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 16px; }
    .info-card { background: white; border: 1px solid var(--border); border-radius: 10px; padding: 16px; }
    .info-label { font-size: 11px; font-weight: 700; text-transform: uppercase; letter-spacing: .7px; color: var(--text-muted); margin-bottom: 6px; }
    .info-value { font-size: 14px; font-weight: 700; color: var(--text-primary); }
    .info-value.muted { font-weight: 400; color: var(--text-secondary); }
    .check-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
    .check-item { display: flex; align-items: center; gap: 10px; padding: 10px 14px; border-radius: 8px; border: 1px solid var(--border); background: white; }
    .check-item.done { background: #f0fdf4; border-color: #86efac; }
    .check-toggle { width: 20px; height: 20px; border-radius: 6px; border: 2px solid var(--border); cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 12px; flex-shrink: 0; transition: all .15s; }
    .check-toggle.done { background: #16a34a; border-color: #16a34a; color: white; }
    .task-mini { padding: 10px 0; border-bottom: 1px solid var(--border); display: flex; align-items: center; gap: 10px; }
    .pri-dot { width: 8px; height: 8px; border-radius: 50%; flex-shrink: 0; }
  </style>
</head>
<body>
<div class="app-layout">
  <div class="main-content">
    <div class="topbar">
      <div style="display:flex;align-items:center;gap:12px">
        <a href="/clients.html" class="btn btn-ghost btn-sm">‚Üê Clienti</a>
        <div class="topbar-title" id="page-title">Cliente</div>
      </div>
    </div>
    <div class="page-content">
      <div id="loading" class="loading-overlay"><div class="spinner"></div></div>
      <div id="content" style="display:none">

        <!-- Header -->
        <div class="client-header">
          <div class="client-avatar" id="avatar">?</div>
          <div style="flex:1">
            <div class="client-name" id="h-name">‚Äî</div>
            <div class="client-meta" id="h-meta"></div>
          </div>
          <div style="display:flex;gap:8px">
            <button class="btn btn-sm" style="background:rgba(255,255,255,.2);color:white;border:1px solid rgba(255,255,255,.3)" onclick="openEdit()">‚úé Modifica</button>
          </div>
        </div>

        <!-- Tabs -->
        <div class="tab-bar">
          <button class="tab active" onclick="switchTab('info',this)">üìã Info</button>
          <button class="tab" onclick="switchTab('onboarding',this)">‚ú¶ Onboarding</button>
          <button class="tab" onclick="switchTab('payments',this)">‚óÜ Pagamenti</button>
          <button class="tab" onclick="switchTab('statements',this)">‚óé Estratti</button>
          <button class="tab" onclick="switchTab('tasks',this)">‚úì Task</button>
          <button class="tab" onclick="openDocuments()">üìÅ Documenti</button>
        </div>

        <!-- Tab: Info -->
        <div class="tab-panel active" id="tab-info">
          <div class="info-grid" id="info-grid"></div>
        </div>

        <!-- Tab: Onboarding -->
        <div class="tab-panel" id="tab-onboarding">
          <div class="card">
            <div class="card-header"><div class="card-title">‚ú¶ Checklist Onboarding</div></div>
            <div id="onboarding-grid" style="padding:16px 20px"></div>
          </div>
        </div>

        <!-- Tab: Pagamenti -->
        <div class="tab-panel" id="tab-payments">
          <div class="card">
            <div class="card-header">
              <div class="card-title">‚óÜ Pagamenti Abbonamento 2026</div>
            </div>
            <div class="table-wrap">
              <table id="payments-table">
                <thead><tr><th>Mese</th><th>Status</th><th>Importo</th><th>Note</th></tr></thead>
                <tbody id="payments-tbody"></tbody>
              </table>
            </div>
          </div>
        </div>

        <!-- Tab: Estratti -->
        <div class="tab-panel" id="tab-statements">
          <div class="card">
            <div class="card-header">
              <div class="card-title">‚óé Estratti Conto 2026</div>
            </div>
            <div class="table-wrap">
              <table id="statements-table">
                <thead><tr><th>Mese</th><th>Ricevuto</th><th>Registrato</th><th>Note</th></tr></thead>
                <tbody id="statements-tbody"></tbody>
              </table>
            </div>
          </div>
        </div>

        <!-- Tab: Task -->
        <div class="tab-panel" id="tab-tasks">
          <div class="card">
            <div class="card-header">
              <div class="card-title">‚úì Task cliente</div>
              <button class="btn btn-accent btn-sm" onclick="newTaskForClient()">+ Task</button>
            </div>
            <div id="client-tasks" style="padding:4px 0"></div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<script src="/js/supabase.js"></script>
<script src="/js/app.js"></script>
<script>
let clientId = null;
let clientData = null;

async function init() {
  await sb.requireAuth();
  const params = new URLSearchParams(window.location.search);
  clientId = params.get('id');
  if (!clientId) { window.location.href = '/clients.html'; return; }
  await loadClient();
}

async function loadClient() {
  try {
    const rows = await sb.db.select('clients', {
      columns: '*,vat_register(*),onboarding_checklist(*)',
      filter: `id=eq.${clientId}`
    });
    if (!rows?.length) { window.location.href = '/clients.html'; return; }
    clientData = rows[0];
    renderClient();
    document.getElementById('loading').style.display = 'none';
    document.getElementById('content').style.display = 'block';
  } catch(e) {
    document.getElementById('loading').innerHTML = `<div class="alert alert-danger">${e.message}</div>`;
  }
}

function renderClient() {
  const c = clientData;
  const initials = (c.company_name||'?').split(/[\s-]/)[0].substring(0,2).toUpperCase();
  document.getElementById('avatar').textContent = initials;
  document.getElementById('h-name').textContent = c.company_name;
  document.getElementById('page-title').textContent = c.company_name;
  document.title = c.company_name + ' ‚Äî InDubai Portal';

  const meta = [];
  if (c.contact_name) meta.push('üë§ '+c.contact_name);
  if (c.email) meta.push('‚úâ '+c.email);
  if (c.phone_uae) meta.push('üì± '+c.phone_uae);
  if (!c.is_active) meta.push('‚ö† INATTIVO');
  document.getElementById('h-meta').innerHTML = meta.join(' &nbsp;¬∑&nbsp; ');

  // Info grid
  const fields = [
    ['Ragione Sociale', c.company_name],
    ['Referente', c.contact_name||'‚Äî'],
    ['Email', c.email||'‚Äî'],
    ['Telefono UAE', c.phone_uae||'‚Äî'],
    ['Partner Contabilit√†', ui.partnerLabel(c.accounting_partner)],
    ['Partner VAT', ui.partnerLabel(c.vat_partner)],
    ['Costo Abbonamento', c.service_cost ? 'AED '+c.service_cost : '‚Äî'],
    ['Giorno Addebito', c.subscription_day ? c.subscription_day+'¬∞ del mese' : '‚Äî'],
    ['Data Avvio', ui.formatDate(c.start_date)],
    ['Trade License', ui.formatDate(c.trade_license_date)],
    ['Scad. Corporate Tax', ui.formatDate(c.corporate_tax_expiry)],
    ['Conti Bancari', c.bank_accounts?.join(', ')||'‚Äî'],
  ];
  document.getElementById('info-grid').innerHTML = fields.map(([l,v]) =>
    `<div class="info-card"><div class="info-label">${l}</div><div class="info-value ${v==='‚Äî'?'muted':''}">${ui.escapeHtml(String(v))}</div></div>`
  ).join('');
  if (c.notes) {
    document.getElementById('info-grid').insertAdjacentHTML('beforeend',
      `<div class="info-card" style="grid-column:1/-1"><div class="info-label">Note</div><div class="info-value muted">${ui.escapeHtml(c.notes)}</div></div>`);
  }
}

function switchTab(name, el) {
  document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
  document.querySelectorAll('.tab-panel').forEach(p => p.classList.remove('active'));
  el.classList.add('active');
  document.getElementById('tab-'+name).classList.add('active');
  if (name === 'onboarding') loadOnboarding();
  if (name === 'payments') loadPayments();
  if (name === 'statements') loadStatements();
  if (name === 'tasks') loadClientTasks();
}

async function loadOnboarding() {
  const ob = clientData.onboarding_checklist?.[0];
  const el = document.getElementById('onboarding-grid');
  if (!ob) { el.innerHTML = '<p style="color:var(--text-muted);font-size:13px">Nessun dato onboarding.</p>'; return; }
  const checks = [
    ['whatsapp_group','Gruppo WhatsApp creato'],
    ['call_scheduled','Call schedulata'],
    ['docs_in_drive','Documenti in Drive'],
    ['eid_verified','EID verificato'],
    ['uae_phone_verified','Telefono UAE verificato'],
    ['corporate_tax_check','Corporate Tax verificato'],
    ['fta_profile_created','Profilo FTA creato'],
    ['ct_registration_done','CT registrazione completata'],
    ['payment_link_sent','Link pagamento inviato'],
    ['bank_accounts_noted','Conti bancari registrati'],
  ];
  el.innerHTML = `<div class="check-grid">` + checks.map(([key, label]) =>
    `<div class="check-item ${ob[key]?'done':''}">
      <div class="check-toggle ${ob[key]?'done':''}" onclick="toggleCheck('${key}',${!ob[key]})">${ob[key]?'‚úì':''}</div>
      <span style="font-size:13px;font-weight:${ob[key]?'700':'400'}">${label}</span>
    </div>`).join('') + '</div>';
  if (ob.notes) el.insertAdjacentHTML('beforeend',
    `<div style="margin-top:16px;padding:12px 14px;background:var(--surface2);border-radius:8px;font-size:13px">${ui.escapeHtml(ob.notes)}</div>`);
}

async function toggleCheck(key, value) {
  try {
    await sb.db.update('onboarding_checklist', `client_id=eq.${clientId}`, {[key]: value});
    if (clientData.onboarding_checklist?.[0]) clientData.onboarding_checklist[0][key] = value;
    loadOnboarding();
  } catch(e) { ui.showToast('Errore: '+e.message,'error'); }
}

async function loadPayments() {
  try {
    const data = await sb.db.select('subscription_payments', {
      filter: `client_id=eq.${clientId}&year=eq.2026`,
      order: 'month.asc'
    });
    const tbody = document.getElementById('payments-tbody');
    if (!data?.length) { tbody.innerHTML = '<tr><td colspan="4" style="text-align:center;color:var(--text-muted);padding:20px">Nessun dato</td></tr>'; return; }
    tbody.innerHTML = data.map(p => `<tr>
      <td>${ui.MONTHS_FULL[p.month-1]} ${p.year}</td>
      <td>${ui.statusBadge(p.status)}</td>
      <td>${p.amount ? 'AED '+p.amount : '‚Äî'}</td>
      <td style="color:var(--text-muted)">${p.notes||'‚Äî'}</td>
    </tr>`).join('');
  } catch(e) { document.getElementById('payments-tbody').innerHTML = `<tr><td colspan="4">${e.message}</td></tr>`; }
}

async function loadStatements() {
  try {
    const data = await sb.db.select('bank_statements', {
      filter: `client_id=eq.${clientId}&year=eq.2026`,
      order: 'month.asc'
    });
    const tbody = document.getElementById('statements-tbody');
    if (!data?.length) { tbody.innerHTML = '<tr><td colspan="4" style="text-align:center;color:var(--text-muted);padding:20px">Nessun dato</td></tr>'; return; }
    tbody.innerHTML = data.map(s => `<tr>
      <td>${ui.MONTHS_FULL[s.month-1]} ${s.year}</td>
      <td>${s.received ? '<span class="badge badge-ok">‚úì S√¨</span>' : '<span class="badge badge-warn">‚úï No</span>'}</td>
      <td>${s.registered ? '<span class="badge badge-ok">‚úì S√¨</span>' : '<span class="badge badge-warn">‚úï No</span>'}</td>
      <td style="color:var(--text-muted)">${s.notes||'‚Äî'}</td>
    </tr>`).join('');
  } catch(e) { document.getElementById('statements-tbody').innerHTML = `<tr><td colspan="4">${e.message}</td></tr>`; }
}

async function loadClientTasks() {
  const el = document.getElementById('client-tasks');
  try {
    const tasks = await sb.db.select('tasks', {
      columns: 'id,title,status,priority,due_date,assigned_to,assigned_profile:profiles!tasks_assigned_to_fkey(full_name)',
      filter: `client_id=eq.${clientId}`,
      order: 'created_at.desc'
    });
    if (!tasks?.length) {
      el.innerHTML = '<div style="padding:20px;text-align:center;color:var(--text-muted);font-size:13px">Nessuna task per questo cliente.</div>';
      return;
    }
    const priColor = {urgent:'#dc2626',high:'#d97706',normal:'#0369a1',low:'#9ca3af'};
    el.innerHTML = tasks.map(t => `
      <div class="task-mini" style="padding:12px 20px">
        <span class="pri-dot" style="background:${priColor[t.priority]||'#6b7a95'}"></span>
        <div style="flex:1">
          <div style="font-size:13px;font-weight:600">${ui.escapeHtml(t.title)}</div>
          ${t.assigned_profile ? `<div style="font-size:11px;color:var(--text-muted)">üë§ ${ui.escapeHtml(t.assigned_profile.full_name)}</div>` : ''}
        </div>
        ${t.due_date ? `<span style="font-size:12px;font-weight:600" class="${ui.deadlineClass(t.due_date)}">${ui.formatDate(t.due_date)}</span>` : ''}
        <a href="/tasks.html" class="btn btn-ghost btn-sm">Apri</a>
      </div>`).join('');
  } catch(e) { el.innerHTML = `<div class="alert alert-danger" style="margin:12px">${e.message}</div>`; }
}

function newTaskForClient() {
  window.location.href = `/tasks.html?client=${clientId}`;
}

function openEdit() {
  // Populate edit modal with current data
  const c = clientData;
  document.getElementById('e-company').value = c.company_name||'';
  document.getElementById('e-contact').value = c.contact_name||'';
  document.getElementById('e-email').value = c.email||'';
  document.getElementById('e-phone').value = c.phone_uae||'';
  document.getElementById('e-partner').value = c.accounting_partner||'';
  document.getElementById('e-vat-partner').value = c.vat_partner||'';
  document.getElementById('e-cost').value = c.service_cost||'';
  document.getElementById('e-sub-day').value = c.subscription_day||'';
  document.getElementById('e-start').value = c.start_date||'';
  document.getElementById('e-tl-date').value = c.trade_license_date||'';
  document.getElementById('e-ct-expiry').value = c.corporate_tax_expiry||'';
  document.getElementById('e-bank-notes').value = c.bank_notes||'';
  document.getElementById('e-notes').value = c.notes||'';
  document.getElementById('e-active').checked = c.is_active!==false;
  document.getElementById('e-bilancio').checked = c.in_bilancio!==false;
  document.getElementById('e-vat-reg').checked = c.vat_registered||false;
  document.getElementById('e-ct-reg').checked = c.corporate_tax_registered||false;
  // Banks
  document.querySelectorAll('#e-banks input[type=checkbox]').forEach(cb => {
    cb.checked = (c.bank_accounts||[]).includes(cb.value);
  });
  document.getElementById('modal-edit').style.display = 'flex';
}

init();
</script>

<!-- Edit Modal -->
<div class="modal-overlay" id="modal-edit" style="display:none">
  <div class="modal" style="max-width:640px">
    <div class="modal-header">
      <div class="modal-title">‚úé Modifica Cliente</div>
      <button class="btn btn-ghost btn-sm" onclick="document.getElementById('modal-edit').style.display='none'">‚úï</button>
    </div>
    <div class="modal-body" style="max-height:70vh;overflow-y:auto">
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px">
        <div class="form-group" style="grid-column:1/-1">
          <label class="form-label">Ragione Sociale *</label>
          <input type="text" class="form-control" id="e-company">
        </div>
        <div class="form-group">
          <label class="form-label">Referente</label>
          <input type="text" class="form-control" id="e-contact">
        </div>
        <div class="form-group">
          <label class="form-label">Email</label>
          <input type="email" class="form-control" id="e-email">
        </div>
        <div class="form-group">
          <label class="form-label">Telefono UAE</label>
          <input type="text" class="form-control" id="e-phone">
        </div>
        <div class="form-group">
          <label class="form-label">Partner Contabilit√†</label>
          <select class="form-control" id="e-partner">
            <option value="">‚Äî</option>
            <option value="noi">Noi</option>
            <option value="vat_consultant">VAT Consultant</option>
            <option value="affinitas">Affinitas</option>
            <option value="in_sospeso">In Sospeso</option>
            <option value="altro">Altro</option>
          </select>
        </div>
        <div class="form-group">
          <label class="form-label">Partner VAT</label>
          <select class="form-control" id="e-vat-partner">
            <option value="">‚Äî</option>
            <option value="noi">Noi</option>
            <option value="vat_consultant">VAT Consultant</option>
            <option value="affinitas">Affinitas</option>
            <option value="in_sospeso">In Sospeso</option>
            <option value="altro">Altro</option>
          </select>
        </div>
        <div class="form-group">
          <label class="form-label">Costo Abbonamento (AED)</label>
          <input type="number" class="form-control" id="e-cost" step="100">
        </div>
        <div class="form-group">
          <label class="form-label">Giorno Addebito</label>
          <input type="number" class="form-control" id="e-sub-day" min="1" max="31">
        </div>
        <div class="form-group">
          <label class="form-label">Data Avvio</label>
          <input type="date" class="form-control" id="e-start">
        </div>
        <div class="form-group">
          <label class="form-label">Trade License Date</label>
          <input type="date" class="form-control" id="e-tl-date">
        </div>
        <div class="form-group">
          <label class="form-label">Scad. Corporate Tax</label>
          <input type="date" class="form-control" id="e-ct-expiry">
        </div>
        <div class="form-group" style="grid-column:1/-1">
          <label class="form-label">Conti Bancari</label>
          <div id="e-banks" style="display:flex;gap:10px;flex-wrap:wrap;padding:10px;background:var(--surface2);border-radius:8px">
            <label style="display:flex;align-items:center;gap:5px;font-size:13px;cursor:pointer"><input type="checkbox" value="wio"> Wio</label>
            <label style="display:flex;align-items:center;gap:5px;font-size:13px;cursor:pointer"><input type="checkbox" value="stripe"> Stripe</label>
            <label style="display:flex;align-items:center;gap:5px;font-size:13px;cursor:pointer"><input type="checkbox" value="paypal"> PayPal</label>
            <label style="display:flex;align-items:center;gap:5px;font-size:13px;cursor:pointer"><input type="checkbox" value="mashreq"> Mashreq</label>
            <label style="display:flex;align-items:center;gap:5px;font-size:13px;cursor:pointer"><input type="checkbox" value="payoneer"> Payoneer</label>
            <label style="display:flex;align-items:center;gap:5px;font-size:13px;cursor:pointer"><input type="checkbox" value="hubpay"> Hubpay</label>
            <label style="display:flex;align-items:center;gap:5px;font-size:13px;cursor:pointer"><input type="checkbox" value="credium"> Credium</label>
            <label style="display:flex;align-items:center;gap:5px;font-size:13px;cursor:pointer"><input type="checkbox" value="ziina"> Ziina</label>
            <label style="display:flex;align-items:center;gap:5px;font-size:13px;cursor:pointer"><input type="checkbox" value="mamo"> Mamo</label>
          </div>
        </div>
        <div class="form-group">
          <label class="form-label">Note Bancarie</label>
          <input type="text" class="form-control" id="e-bank-notes">
        </div>
        <div class="form-group">
          <label class="form-label">Note</label>
          <textarea class="form-control" id="e-notes" rows="2"></textarea>
        </div>
        <div class="form-group">
          <label style="display:flex;align-items:center;gap:8px;font-size:13px;cursor:pointer;font-weight:600">
            <input type="checkbox" id="e-active"> Cliente Attivo
          </label>
          <label style="display:flex;align-items:center;gap:8px;font-size:13px;cursor:pointer;font-weight:600;margin-top:8px">
            <input type="checkbox" id="e-bilancio"> In Bilancio
          </label>
          <label style="display:flex;align-items:center;gap:8px;font-size:13px;cursor:pointer;font-weight:600;margin-top:8px">
            <input type="checkbox" id="e-vat-reg"> VAT Registrato
          </label>
          <label style="display:flex;align-items:center;gap:8px;font-size:13px;cursor:pointer;font-weight:600;margin-top:8px">
            <input type="checkbox" id="e-ct-reg"> Corporate Tax Registrato
          </label>
        </div>
      </div>
    </div>
    <div class="modal-footer" style="justify-content:space-between">
      <button class="btn" style="background:#fee2e2;color:#dc2626;border:1px solid #fca5a5" onclick="deleteClient()">üóë Elimina Cliente</button>
      <div style="display:flex;gap:8px">
        <button class="btn btn-ghost" onclick="document.getElementById('modal-edit').style.display='none'">Annulla</button>
        <button class="btn btn-accent" id="btn-save-edit" onclick="saveEdit()">Salva Modifiche</button>
      </div>
    </div>
  </div>
</div>

<script>
async function saveEdit() {
  const company = document.getElementById('e-company').value.trim();
  if (!company) { ui.showToast('Nome azienda obbligatorio','error'); return; }
  const btn = document.getElementById('btn-save-edit');
  btn.disabled = true; btn.textContent = 'Salvo...';
  const banks = [...document.querySelectorAll('#e-banks input:checked')].map(el => el.value);
  try {
    await sb.db.update('clients', `id=eq.${clientId}`, {
      company_name: company,
      contact_name: document.getElementById('e-contact').value.trim()||null,
      email: document.getElementById('e-email').value.trim()||null,
      phone_uae: document.getElementById('e-phone').value.trim()||null,
      accounting_partner: document.getElementById('e-partner').value||null,
      vat_partner: document.getElementById('e-vat-partner').value||null,
      service_cost: parseFloat(document.getElementById('e-cost').value)||null,
      subscription_day: parseInt(document.getElementById('e-sub-day').value)||null,
      start_date: document.getElementById('e-start').value||null,
      trade_license_date: document.getElementById('e-tl-date').value||null,
      corporate_tax_expiry: document.getElementById('e-ct-expiry').value||null,
      bank_accounts: banks.length ? banks : null,
      bank_notes: document.getElementById('e-bank-notes').value.trim()||null,
      notes: document.getElementById('e-notes').value.trim()||null,
      is_active: document.getElementById('e-active').checked,
      in_bilancio: document.getElementById('e-bilancio').checked,
      vat_registered: document.getElementById('e-vat-reg').checked,
      corporate_tax_registered: document.getElementById('e-ct-reg').checked,
    });
    document.getElementById('modal-edit').style.display = 'none';
    ui.showToast('Cliente aggiornato ‚úì','success');
    await loadClient();
  } catch(e) { ui.showToast('Errore: '+e.message,'error'); }
  finally { btn.disabled=false; btn.textContent='Salva Modifiche'; }
}

async function deleteClient() {
  if (!confirm('Eliminare questo cliente? L\'operazione √® irreversibile.')) return;
  try {
    await sb.db.delete('clients', `id=eq.${clientId}`);
    ui.showToast('Cliente eliminato','success');
    setTimeout(() => window.location.href='/clients.html', 800);
  } catch(e) { ui.showToast('Errore: '+e.message,'error'); }
}
</script>
</body>
</html>
